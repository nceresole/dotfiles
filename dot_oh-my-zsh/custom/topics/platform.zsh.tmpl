# =============================================================================
# Platform-Specific Configuration
# Topic: platform.zsh
# =============================================================================

{{- if .is_macos }}
# -----------------------------------------------------------------------------
# macOS Specific
# -----------------------------------------------------------------------------

# Finder
alias showfiles='defaults write com.apple.finder AppleShowAllFiles YES; killall Finder'
alias hidefiles='defaults write com.apple.finder AppleShowAllFiles NO; killall Finder'

# Open applications
alias finder='open -a Finder'
alias preview='open -a Preview'

# Flush DNS cache
alias flushdns='sudo dscacheutil -flushcache; sudo killall -HUP mDNSResponder'

# Show/hide desktop icons
alias hidedesktop='defaults write com.apple.finder CreateDesktop -bool false && killall Finder'
alias showdesktop='defaults write com.apple.finder CreateDesktop -bool true && killall Finder'

# Lock screen
alias lock='/System/Library/CoreServices/Menu\ Extras/User.menu/Contents/Resources/CGSession -suspend'

# Empty trash
alias emptytrash='sudo rm -rf ~/.Trash/*'

# Update macOS and Homebrew
alias update='sudo softwareupdate -i -a; brew update; brew upgrade; brew cleanup'

{{- else if .is_wsl }}
# -----------------------------------------------------------------------------
# WSL Specific
# -----------------------------------------------------------------------------

# Windows integration
alias explorer='explorer.exe .'
alias open='explorer.exe'
alias clip='clip.exe'

# Get Windows username
export WINHOME="/mnt/c/Users/$(powershell.exe -Command 'Write-Host -NoNewline $env:USERNAME' 2>/dev/null | tr -d '\r')"

# Open in VS Code (Windows)
alias code='/mnt/c/Users/*/AppData/Local/Programs/Microsoft\ VS\ Code/bin/code'

# Clipboard operations
pbcopy() { clip.exe; }
pbpaste() { powershell.exe -Command Get-Clipboard | tr -d '\r'; }

# SSH agent (keychain for WSL)
if command -v keychain &>/dev/null; then
    [ -f "$HOME/.ssh/id_ed25519" ] && eval $(keychain --eval --quiet id_ed25519 2>/dev/null) || true
fi

{{- else if .is_linux }}
# -----------------------------------------------------------------------------
# Linux Specific
# -----------------------------------------------------------------------------

# Clipboard (xclip)
if command -v xclip &>/dev/null; then
    alias pbcopy='xclip -selection clipboard'
    alias pbpaste='xclip -selection clipboard -o'
fi

# Open file manager
if command -v nautilus &>/dev/null; then
    alias open='nautilus'
elif command -v dolphin &>/dev/null; then
    alias open='dolphin'
elif command -v thunar &>/dev/null; then
    alias open='thunar'
fi

# Package manager aliases (detect distro)
if command -v apt &>/dev/null; then
    alias update='sudo apt update && sudo apt upgrade -y'
    alias install='sudo apt install'
    alias remove='sudo apt remove'
elif command -v dnf &>/dev/null; then
    alias update='sudo dnf upgrade -y'
    alias install='sudo dnf install'
    alias remove='sudo dnf remove'
elif command -v pacman &>/dev/null; then
    alias update='sudo pacman -Syu'
    alias install='sudo pacman -S'
    alias remove='sudo pacman -R'
fi

# SSH agent (keychain)
if command -v keychain &>/dev/null; then
    [ -f "$HOME/.ssh/id_ed25519" ] && eval $(keychain --eval --quiet id_ed25519 2>/dev/null) || true
fi

{{- end }}

# -----------------------------------------------------------------------------
# Cross-Platform Data Paths
# -----------------------------------------------------------------------------
{{- if .is_wsl }}
if [[ -d "/mnt/c/__data" ]]; then
    export DATA_ROOT="/mnt/c/__data"
fi
{{- else }}
if [[ -d "/__data" ]]; then
    export DATA_ROOT="/__data"
elif [[ -d "$HOME/__data" ]]; then
    export DATA_ROOT="$HOME/__data"
fi
{{- end }}

# Data navigation aliases
if [ -n "$DATA_ROOT" ]; then
    if command -v zoxide &>/dev/null; then
        alias data="z $DATA_ROOT"
        alias projects="z $DATA_ROOT/4_projects"
        alias inbox="z $DATA_ROOT/0_inbox"
        alias heavy="z $DATA_ROOT/__local/projects"
    else
        alias data="cd $DATA_ROOT"
        alias projects="cd $DATA_ROOT/4_projects"
        alias inbox="cd $DATA_ROOT/0_inbox"
        alias heavy="cd $DATA_ROOT/__local/projects"
    fi
fi
